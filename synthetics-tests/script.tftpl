var assert = require("assert");
var got = require("got");

function randHex(len) {
  var maxlen = 8,
      min = Math.pow(16,Math.min(len,maxlen)-1), 
      max = Math.pow(16,Math.min(len,maxlen)) - 1,
      n   = Math.floor( Math.random() * (max-min+1) ) + min,
      r   = n.toString(16);
  while ( r.length < len ) {
     r = r + randHex( len - maxlen );
  }
  return r;
}

var traceparent = "00-" + randHex(32) + "-" + randHex(16) + "-01";
console.log(traceparent);

const options = {
  headers: {
    "traceparent": traceparent,
    "tracestate": ""
  }
};

const response = await got.get('${APIGEE_PROTOCOL}://${APIGEE_HOST}${ENDPOINT}', options)

let jsonBody = JSON.parse(response.body);
console.log('Response:', jsonBody);
assert.equal(response.statusCode, 200, 'Expected a 200 OK response');
assert.equal(jsonBody.name, 'Luke Skywalker', 'Expected name to equal Luke Skywalker');